import pandas
import matplotlib.pyplot as plt
import numpy as np
import seaborn as sns

i = 1

while(i<16):
  csvFile = pandas.read_csv('Analysis\Replication\dataneeded\Participant_'+str(i)+'.csv',usecols=["Payoff Condition","Time Condition","Choice"])
  data_list = csvFile.values.tolist()
  df = pandas.DataFrame(data_list)
  df.rename(columns={ 0: 'Choice', 1: 'Time Condition', 2: 'Payoff Condition' }, inplace = True)
  dfreq = df.groupby(['Payoff Condition', 'Time Condition', 'Choice']).agg(n=('Choice', 'count'))
  dfreq = dfreq.reset_index()
  dfreq['prop'] = dfreq['n'] / 40
  dfreq['random'] = 0.25
  i = i + 1

dfreq['p_value'] = dfreq['prop'] - dfreq['random']
sns.set(style='whitegrid')
g = sns.catplot(x='Choice', y= 'p_value', data=dfreq, hue='Time Condition', 
                col='Payoff Condition', kind='bar', dodge=True, aspect=0.8, ci=None)
(g.set_axis_labels("Arms", "p(choice)-p(chance)")
  .set_titles("{col_name}")
  .set(ylim=(-0.3, 0.3)))
g.fig.suptitle('Arm frequency', y=1.03)
plt.show()